experiment_name: bs-roformer_vocals
experiment_description: BS Roformer experiment with vocals.
experiment_topic: Music-Source-Separation
experiment_tracker:
  name: MLFlowExperimentTracker
log_level: INFO
plugins:
  - hijos
output_folder: output

train:
  epochs: 20
  data:
    train:
      datasets:
        - name: MUSDB18HQ
          kwargs:
            targets: vocals
            subsets: [train]
            split: train
            num_repetions: 25
      dataloader:
        name: TorchDataLoader
        kwargs:
          drop_last: True
        num_workers: 4
        batch_size: 2
        decoder:
          name: MusicSourceDecoder
        data_transforms:
          - name: RandomAudioChunk
            kwargs:
              chunk_length: 176400
              stereo: True
          - name: ToTorchTensor
    eval:
      datasets:
        - name: MUSDB18HQ
          kwargs:
            targets: vocals
            subsets: [train]
            split: valid
      dataloader:
        name: TorchDataLoader
        kwargs:
          drop_last: False
          shuffle_each_epoch: False
        num_workers: 1
        batch_size: 1
        decoder:
          name: MusicSourceDecoder
          kwargs:
            stereo_to_batch: False
        data_transforms:
          - name: AudioToChunks
            kwargs:
              chunk_length: 176400
              hop_length: 132300
              stereo: True
          - name: ToTorchTensor
  model:
    name: TorchBSRoformer
    kwargs:
      dim: 128
      depth: 4
      time_transformer_depth: 1
      freq_transformer_depth: 1
      heads: 4
      num_stems: 1
      stereo: False
      stft_n_fft: 2048
      window_sizes: [4096, 2048, 1024, 512, 256]
      window_fn: hann
  criteria:
    name: TorchSourceSeparationL1Criteria
  optimizer:
    name: TorchAdamWOptimizer
    kwargs:
      lr: 0.01
  looper:
    name: MusicSourceSeparationLooper
    kwargs:
      mixed_precision: False
      compile: False
      use_gpu: True
      accumulate_gradient: 32
      eval_batch_size: 8
  evaluator:
    name: MusicSourceSeparationEvaluator
    kwargs:
      chunk_length: 176400
      hop_length: 132300
      stereo: True
  metrics:
    - name: MusicSourceSeparationMetric
      kwargs:
        targets: vocals
  saver:
    name: TorchModelSaver
evaluation:
  datasets:
    - name: MUSDB18HQ
      kwargs:
        targets: vocals
        subsets: [test]
    - name: MUSDB18HQ
      kwargs:
        targets: bass
        subsets: [test]
    - name: MUSDB18HQ
      kwargs:
        targets: drums
        subsets: [test]
    - name: MUSDB18HQ
      kwargs:
        targets: other
        subsets: [test]
  dataloader:
    name: TorchDataLoader
    kwargs:
      drop_last: False
      shuffle_each_epoch: False
    num_workers: 1
    batch_size: 1
    decoder:
      name: MusicSourceDecoder
      kwargs:
        stereo_to_batch: False
    data_transforms:
      - name: AudioToChunks
        kwargs:
          chunk_length: 176400
          hop_length: 132300
          stereo: True
      - name: StereoToBatch
      - name: ToTorchTensor
  processor:
    name: MusicSourceSeparationProcessor
    kwargs:
      use_gpu: True
      eval_batch_size: 8
  evaluator:
    name: MusicSourceSeparationEvaluator
    kwargs:
      chunk_length: 176400
      hop_length: 132300
      stereo: True
  metrics:
    - name: MusicSourceSeparationMetric
      kwargs:
        targets: vocals
